Ã‡oklu PDF yÃ¼kleme iÃ§in kullanÄ±lan endpoint ve veri formatÄ±nÄ± inceleyeyim:


[3 tools called]

## ğŸ“‹ **Ã‡oklu PDF YÃ¼kleme API Endpoint'i ve Veri FormatÄ±**

### ğŸ”— **Endpoint**
```
POST /api/admin/documents/bulk-upload
```

### ğŸ“¤ **Ä°stek FormatÄ± (Request)**

#### **Headers**
```http
Authorization: Bearer {access_token}
Content-Type: multipart/form-data
```

#### **FormData AlanlarÄ±**
```javascript
// Zorunlu alanlar
files: File[]                    // PDF dosyalarÄ± (multiple)
category: string                // Kategori (Ã¶rn: "mevzuat", "kanun")
institution: string            // Kurum (Ã¶rn: "TBB", "Adalet BakanlÄ±ÄŸÄ±")
belge_adi: string              // Belge adÄ± (Ã¶rn: "TCK_2024")

// Opsiyonel alanlar
metadata: string               // JSON string formatÄ±nda metadata
```

#### **Metadata JSON FormatÄ±**
```json
{
  "pdf_sections": [
    {
      "output_filename": "dosya1.pdf",
      "title": "Dosya BaÅŸlÄ±ÄŸÄ±",
      "description": "Dosya aÃ§Ä±klamasÄ±",
      "keywords": "anahtar, kelimeler"
    },
    {
      "output_filename": "dosya2.pdf", 
      "title": "Ä°kinci Dosya",
      "description": "Ä°kinci dosya aÃ§Ä±klamasÄ±",
      "keywords": "diÄŸer, anahtar, kelimeler"
    }
  ]
}
```

### ğŸ“¥ **Cevap FormatÄ± (Response)**

#### **BaÅŸarÄ±lÄ± Cevap (200 OK)**
```json
{
  "success": true,
  "timestamp": "2024-10-19T10:30:00Z",
  "data": {
    "batch_id": "batch_abc123def456",
    "total_files": 3,
    "tasks": [
      {
        "task_id": "task_001",
        "document_id": "doc_123",
        "filename": "dosya1.pdf",
        "status": "queued"
      },
      {
        "task_id": "task_002", 
        "document_id": "doc_124",
        "filename": "dosya2.pdf",
        "status": "queued"
      },
      {
        "task_id": "task_003",
        "document_id": "doc_125", 
        "filename": "dosya3.pdf",
        "status": "queued"
      }
    ]
  },
  "message": "Toplu yÃ¼kleme baÅŸlatÄ±ldÄ±"
}
```

#### **Hata CevabÄ± (400/422)**
```json
{
  "success": false,
  "message": "Eksik alanlar: category, institution",
  "detail": [
    {
      "loc": ["category"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

### ğŸ”„ **Progress Takibi Endpoint'leri**

#### **Task Progress**
```
GET /api/admin/documents/bulk-upload/progress/{task_id}
```

**Cevap:**
```json
{
  "status": "success",
  "data": {
    "task_id": "task_001",
    "document_id": 123,
    "filename": "dosya1.pdf",
    "status": "processing",
    "progress_percent": 65,
    "stage": "embed",
    "created_at": "2024-10-19T10:30:00Z",
    "updated_at": "2024-10-19T10:32:00Z"
  }
}
```

#### **Batch Progress**
```
GET /api/admin/documents/bulk-upload/batch/{batch_id}/progress
```

**Cevap:**
```json
{
  "status": "success", 
  "data": {
    "batch_id": "batch_abc123def456",
    "total_files": 3,
    "completed_count": 1,
    "failed_count": 0,
    "queued_count": 1,
    "processing_count": 1,
    "batch_status": "processing",
    "created_at": "2024-10-19T10:30:00Z",
    "tasks": [
      {
        "task_id": "task_001",
        "document_id": 123,
        "filename": "dosya1.pdf",
        "status": "completed"
      },
      {
        "task_id": "task_002",
        "document_id": 124, 
        "filename": "dosya2.pdf",
        "status": "processing"
      },
      {
        "task_id": "task_003",
        "document_id": 125,
        "filename": "dosya3.pdf", 
        "status": "queued"
      }
    ]
  }
}
```

### ğŸ“ **Ã–rnek KullanÄ±m (JavaScript)**

```javascript
const formData = new FormData();

// DosyalarÄ± ekle
files.forEach(file => {
  formData.append('files', file);
});

// Zorunlu alanlar
formData.append('category', 'mevzuat');
formData.append('institution', 'TBB');
formData.append('belge_adi', 'TCK_2024');

// Metadata (opsiyonel)
const metadata = {
  pdf_sections: files.map(file => ({
    output_filename: file.name,
    title: file.name.replace('.pdf', ''),
    description: `TCK_2024 - ${file.name}`,
    keywords: 'mevzuat, TBB'
  }))
};
formData.append('metadata', JSON.stringify(metadata));

// API Ã§aÄŸrÄ±sÄ±
const response = await fetch('/api/admin/documents/bulk-upload', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
});

const result = await response.json();
console.log('Batch ID:', result.data.batch_id);
```

### âš ï¸ **Hata DurumlarÄ±**

- **401**: Token geÃ§ersiz
- **400**: GeÃ§ersiz dosya formatÄ± veya metadata
- **422**: Zorunlu alanlar eksik
- **413**: Dosya boyutu Ã§ok bÃ¼yÃ¼k
- **500**: Sunucu hatasÄ±

Bu endpoint ile Ã§oklu PDF yÃ¼kleme iÅŸlemi baÅŸlatÄ±lÄ±r ve her dosya iÃ§in ayrÄ± task oluÅŸturulur. Progress takibi iÃ§in batch_id kullanÄ±lÄ±r.